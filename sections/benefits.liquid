{% comment %}
  Section: Benefits around center image + subtle zoom on scroll
{% endcomment %}

<section class="bcZ" id="bcZ-{{ section.id }}" style="
  --bcz-bg: {{ section.settings.bg_color }};
  --bcz-text: {{ section.settings.text_color }};
  --bcz-line: {{ section.settings.line_color }};
  --bcz-dot: {{ section.settings.dot_color }};
  --bcz-max: {{ section.settings.max_scale }};
">
  <div class="bcZ__wrap">
    {% if section.settings.title != blank %}
      <h2 class="bcZ__title">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="bcZ__grid">
      <div class="bcZ__col bcZ__col--left">
        {% for block in section.blocks %}
          {% if block.type == 'benefit' and block.settings.side == 'left' %}
            <div class="bcZ__item" {{ block.shopify_attributes }}>
              <span class="bcZ__dot" aria-hidden="true"></span>
              <div class="bcZ__copy">
                <p class="bcZ__headline">{{ block.settings.heading }}</p>
                {% if block.settings.text != blank %}
                  <p class="bcZ__text">{{ block.settings.text }}</p>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="bcZ__center">
        <div class="bcZ__media">
          {% if section.settings.image != blank %}
            <img
              src="{{ section.settings.image | image_url: width: 900 }}"
              alt="{{ section.settings.image_alt | escape }}"
              loading="lazy"
              class="bcZ__img"
            >
          {% else %}
            <div class="bcZ__placeholder">Ajoute l'image produit</div>
          {% endif %}
        </div>
      </div>

      <div class="bcZ__col bcZ__col--right">
        {% for block in section.blocks %}
          {% if block.type == 'benefit' and block.settings.side == 'right' %}
            <div class="bcZ__item bcZ__item--right" {{ block.shopify_attributes }}>
              <div class="bcZ__copy bcZ__copy--right">
                <p class="bcZ__headline">{{ block.settings.heading }}</p>
                {% if block.settings.text != blank %}
                  <p class="bcZ__text">{{ block.settings.text }}</p>
                {% endif %}
              </div>
              <span class="bcZ__dot" aria-hidden="true"></span>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      {% if section.settings.show_lines %}
        <div class="bcZ__lines" aria-hidden="true">
          <span class="bcZ__line bcZ__line--1"></span>
          <span class="bcZ__line bcZ__line--2"></span>
          <span class="bcZ__line bcZ__line--3"></span>
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    (function(){
      const root = document.getElementById("bcZ-{{ section.id }}");
      if (!root) return;

      const media = root.querySelector(".bcZ__media");
      if (!media) return;

      function setScale(p) {
        const max = parseFloat(getComputedStyle(root).getPropertyValue("--bcz-max")) || 1.1;
        const s = 1 + (max - 1) * p;
        media.style.setProperty("--scale", s.toFixed(3));
      }

      let active = false;
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          active = entry.isIntersecting;
          if (!active) setScale(0);
        });
      }, { threshold: [0, 0.2, 0.6, 1] });

      io.observe(root);

      function onScroll(){
        if (!active) return;

        const r = root.getBoundingClientRect();
        const vh = window.innerHeight || document.documentElement.clientHeight;

        const start = vh * 0.85;
        const end   = vh * 0.15;
        const p = (start - r.top) / (start - end);
        const clamped = Math.max(0, Math.min(1, p));

        setScale(clamped);
      }

      window.addEventListener("scroll", onScroll, { passive: true });
      window.addEventListener("resize", onScroll);
      onScroll();
    })();
  </script>
</section>

<style>
  .bcZ{
    background: var(--bcz-bg);
    color: var(--bcz-text);
    padding: 46px 0;
  }
  .bcZ__wrap{
    max-width: 1180px;
    margin: 0 auto;
    padding: 0 16px;
  }
  .bcZ__title{
    text-align: center;
    margin: 0 0 28px;
    font-weight: 800;
    letter-spacing: .02em;
  }

  .bcZ__grid{
    position: relative;
    display: grid;
    grid-template-columns: 1fr minmax(220px, 360px) 1fr;
    gap: 22px;
    align-items: center;
  }

  .bcZ__col{
    display: flex;
    flex-direction: column;
    gap: 18px;
    z-index: 2;
  }

  .bcZ__item{
    display: grid;
    grid-template-columns: 18px 1fr;
    gap: 12px;
    align-items: start;
  }
  .bcZ__item--right{
    grid-template-columns: 1fr 18px;
  }

  .bcZ__dot{
    width: 14px;
    height: 14px;
    border-radius: 999px;
    background: var(--bcz-dot);
    box-shadow: 0 0 0 6px color-mix(in srgb, var(--bcz-dot) 18%, transparent);
    margin-top: 4px;
  }

  .bcZ__headline{
    margin: 0;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: .08em;
    font-size: 14px;
    line-height: 1.25;
  }
  .bcZ__text{
    margin: 6px 0 0;
    opacity: .85;
    font-size: 13px;
    line-height: 1.45;
  }

  .bcZ__center{
    z-index: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .bcZ__media{
    width: 100%;
    max-width: 340px;
    aspect-ratio: 1 / 1;
    display: grid;
    place-items: center;
    transform: scale(var(--scale, 1));
    transform-origin: center center;
    transition: transform 120ms linear;
  }

  .bcZ__img{
    width: 100%;
    height: auto;
    display: block;
    object-fit: contain;
    pointer-events: none;
  }

  .bcZ__placeholder{
    width: 100%;
    height: 320px;
    border-radius: 22px;
    border: 1px dashed color-mix(in srgb, var(--bcz-text) 18%, transparent);
    display: grid;
    place-items: center;
    opacity: .7;
  }

  .bcZ__lines{
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }
  .bcZ__line{
    position: absolute;
    left: 4%;
    right: 4%;
    height: 1px;
    background: color-mix(in srgb, var(--bcz-line) 35%, transparent);
  }
  .bcZ__line--1{ top: 27%; }
  .bcZ__line--2{ top: 50%; }
  .bcZ__line--3{ top: 73%; }

  @media (max-width: 900px){
    .bcZ__grid{ grid-template-columns: 1fr; }
    .bcZ__center{ order: -1; margin-bottom: 8px; }
    .bcZ__item, .bcZ__item--right{ grid-template-columns: 18px 1fr; }
    .bcZ__lines{ display: none; }
  }
</style>

{% schema %}
{
  "name": "Bénéfices + produit",
  "settings": [
    { "type": "text", "id": "title", "label": "Titre", "default": "Pourquoi HUSHA ?" },

    { "type": "image_picker", "id": "image", "label": "Image centre" },
    { "type": "text", "id": "image_alt", "label": "ALT", "default": "Bouchon anti-bruit" },

    { "type": "color", "id": "bg_color", "label": "Fond", "default": "#0B1220" },
    { "type": "color", "id": "text_color", "label": "Texte", "default": "#E5E7EB" },
    { "type": "color", "id": "line_color", "label": "Lignes", "default": "#1F2937" },
    { "type": "color", "id": "dot_color", "label": "Points", "default": "#334155" },

    { "type": "checkbox", "id": "show_lines", "label": "Afficher les lignes", "default": true },

    {
      "type": "range",
      "id": "max_scale",
      "label": "Zoom max",
      "min": 1.0,
      "max": 1.6,
      "step": 0.1,
      "default": 1.1
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Bénéfice",
      "settings": [
        {
          "type": "select",
          "id": "side",
          "label": "Côté",
          "options": [
            { "value": "left", "label": "Gauche" },
            { "value": "right", "label": "Droite" }
          ],
          "default": "left"
        },
        { "type": "text", "id": "heading", "label": "Titre", "default": "Bénéfice" },
        { "type": "text", "id": "text", "label": "Texte (optionnel)", "default": "Une phrase courte." }
      ]
    }
  ],
  "presets": [
    {
      "name": "Bénéfices + produit",
      "blocks": [
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "benefit" }
      ]
    }
  ]
}
{% endschema %}
