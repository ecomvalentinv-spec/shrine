{% comment %}
  Section: Vertical Logo Ticker (images)
  - Upload logos as blocks
  - Smooth infinite vertical loop
{% endcomment %}

<section class="vlt" style="
  --vlt-bg: {{ section.settings.bg_color }};
  --vlt-text: {{ section.settings.text_color }};
  --vlt-height: {{ section.settings.height }}px;
  --vlt-speed: {{ section.settings.speed }}s;
">
  <div class="vlt__wrap">
    {% if section.settings.title != blank %}
      <p class="vlt__title">{{ section.settings.title }}</p>
    {% endif %}

    <div class="vlt__viewport" aria-label="Logos" role="list">
      <div class="vlt__track" id="vlt-track-{{ section.id }}">
        {%- assign logos_count = 0 -%}

        {%- for block in section.blocks -%}
          {%- if block.type == "logo" and block.settings.image != blank -%}
            {%- assign logos_count = logos_count | plus: 1 -%}
            <div class="vlt__item" role="listitem" {{ block.shopify_attributes }}>
              {% if block.settings.link != blank %}
                <a class="vlt__link" href="{{ block.settings.link }}" target="_blank" rel="noopener">
              {% endif %}

              <img
                src="{{ block.settings.image | image_url: width: 320 }}"
                alt="{{ block.settings.alt | escape }}"
                loading="lazy"
                class="vlt__img"
              >

              {% if block.settings.link != blank %}
                </a>
              {% endif %}
            </div>
          {%- endif -%}
        {%- endfor -%}

        {%- comment -%}
          Duplicate the same list once to create a seamless loop.
        {%- endcomment -%}
        {%- for block in section.blocks -%}
          {%- if block.type == "logo" and block.settings.image != blank -%}
            <div class="vlt__item vlt__item--dup" role="listitem">
              {% if block.settings.link != blank %}
                <a class="vlt__link" href="{{ block.settings.link }}" target="_blank" rel="noopener">
              {% endif %}

              <img
                src="{{ block.settings.image | image_url: width: 320 }}"
                alt="{{ block.settings.alt | escape }}"
                loading="lazy"
                class="vlt__img"
              >

              {% if block.settings.link != blank %}
                </a>
              {% endif %}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </div>

  <script>
    (function() {
      const track = document.getElementById("vlt-track-{{ section.id }}");
      if (!track) return;

      // Ensure enough content for looping: if too few logos, slow down a bit
      const items = track.querySelectorAll(".vlt__item:not(.vlt__item--dup)");
      if (items.length < 4) {
        track.style.setProperty("--vlt-speed", ({{ section.settings.speed }} * 1.3) + "s");
      }
    })();
  </script>
</section>

<style>
  .vlt{
    background: var(--vlt-bg);
    color: var(--vlt-text);
    padding: 28px 0;
  }
  .vlt__wrap{
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 16px;
    text-align: center;
  }
  .vlt__title{
    margin: 0 0 14px;
    font-weight: 700;
    letter-spacing: .14em;
    text-transform: uppercase;
    font-size: 18px;
  }
  .vlt__viewport{
    height: var(--vlt-height);
    overflow: hidden;
    position: relative;
    mask-image: linear-gradient(to bottom, transparent 0%, black 12%, black 88%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 12%, black 88%, transparent 100%);
  }
  .vlt__track{
    display: flex;
    flex-direction: column;
    gap: {{ section.settings.gap }}px;
    will-change: transform;
    animation: vlt-scroll var(--vlt-speed) linear infinite;
    padding: 6px 0;
  }

  /* Pause on hover (nice premium touch) */
  .vlt__viewport:hover .vlt__track{
    animation-play-state: paused;
  }

  .vlt__item{
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 46px;
  }

  .vlt__link{ display: inline-flex; }

  .vlt__img{
    height: {{ section.settings.logo_height }}px;
    width: auto;
    max-width: 80vw;
    filter: grayscale(1);
    opacity: .9;
    transition: filter .2s ease, opacity .2s ease, transform .2s ease;
  }
  .vlt__viewport:hover .vlt__img{
    filter: grayscale(0);
    opacity: 1;
  }

  @keyframes vlt-scroll{
    0%   { transform: translateY(0); }
    100% { transform: translateY(-50%); }
  }

  @media (max-width: 640px){
    .vlt{ padding: 22px 0; }
    .vlt__title{ font-size: 16px; }
  }
</style>

{% schema %}
{
  "name": "Vertical ticker (logos)",
  "settings": [
    { "type": "text", "id": "title", "label": "Titre", "default": "VU SUR" },
    { "type": "color", "id": "bg_color", "label": "Fond", "default": "#0B1220" },
    { "type": "color", "id": "text_color", "label": "Texte", "default": "#E5E7EB" },

    { "type": "range", "id": "height", "label": "Hauteur (px)", "min": 120, "max": 420, "step": 10, "default": 220 },
    { "type": "range", "id": "logo_height", "label": "Hauteur logo (px)", "min": 18, "max": 64, "step": 2, "default": 28 },
    { "type": "range", "id": "gap", "label": "Espacement (px)", "min": 6, "max": 34, "step": 2, "default": 16 },

    { "type": "range", "id": "speed", "label": "Vitesse (secondes)", "min": 6, "max": 30, "step": 1, "default": 14 }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image logo" },
        { "type": "text", "id": "alt", "label": "ALT", "default": "Logo" },
        { "type": "url", "id": "link", "label": "Lien (optionnel)" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vertical ticker (logos)",
      "blocks": [
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" }
      ]
    }
  ]
}
{% endschema %}
